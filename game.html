<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UNO â€” Game</title>
    <meta name="description" content="UNO online game board â€” play cards, call UNO, and win!">
    <meta name="theme-color" content="#ED1C24">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ´</text></svg>">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
</head>
<body class="game-page">

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="top-bar-left">
            <span class="top-bar-logo">UNO</span>
            <span class="room-code-badge" id="gameRoomCode" onclick="copyCode()">------</span>
        </div>
        <div class="top-bar-center">
            <div class="direction-arrow-wrap" id="directionArrowWrap">
                <svg class="direction-arrow-svg" id="directionArrowSvg" viewBox="0 0 40 40" width="36" height="36">
                    <circle cx="20" cy="20" r="15" fill="none" stroke="rgba(255,255,255,0.12)" stroke-width="2"/>
                    <path id="dirArrowPath" class="dir-arrow-path" d="M 20 5 A 15 15 0 1 1 5 20" fill="none" stroke="var(--uno-yellow)" stroke-width="2.5" stroke-linecap="round" marker-end="url(#arrowHead)"/>
                    <defs><marker id="arrowHead" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto"><path d="M0,0 L6,3 L0,6" fill="var(--uno-yellow)" /></marker></defs>
                </svg>
            </div>
            <span id="turnLabel">Turn: â€”</span>
            <div class="current-color-dot" id="currentColorDot"></div>
            <div class="turn-timer" id="turnTimer">
                <svg viewBox="0 0 36 36" class="timer-ring">
                    <circle cx="18" cy="18" r="16" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="3"/>
                    <circle class="timer-progress" id="timerProgress" cx="18" cy="18" r="16" fill="none" stroke="var(--uno-yellow)" stroke-width="3" stroke-dasharray="100.53" stroke-dashoffset="0" stroke-linecap="round" transform="rotate(-90 18 18)"/>
                </svg>
                <span class="timer-text" id="timerText">30</span>
            </div>
        </div>
        <div class="top-bar-right">
            <button class="btn-icon" id="btnSound" onclick="toggleSound()" title="Toggle Sound">ğŸ”Š</button>
            <button class="btn-icon" onclick="shareRoom()" title="Share Room">ğŸ”—</button>
            <button class="btn-leave" onclick="handleLeave()">Leave</button>
        </div>
    </div>

    <!-- Opponents -->
    <div class="opponents-area" id="opponentsArea">
        <!-- Skeleton placeholders -->
        <div class="opponent-slot skeleton-slot"><div class="skeleton-bar"></div><div class="skeleton-bar short"></div></div>
        <div class="opponent-slot skeleton-slot"><div class="skeleton-bar"></div><div class="skeleton-bar short"></div></div>
    </div>

    <!-- Center Table -->
    <div class="table-center">
        <div class="pile-wrapper">
            <div class="draw-pile-container" id="drawPile" onclick="handleDraw()">
                <div class="uno-card card-back pile-card">
                    <div class="card-inner"></div>
                    <div class="card-back-design"><span>UNO</span></div>
                </div>
                <span class="pile-count" id="drawPileCount">0</span>
            </div>
            <span class="pile-label">Draw</span>
        </div>

        <div class="pile-wrapper">
            <div class="discard-pile-container" id="discardPile"></div>
            <span class="pile-label">Discard</span>
        </div>
    </div>



    <!-- Player Hand -->
    <div class="player-hand-area">
        <div class="hand-info">
            <div class="hand-info-left">
                <span class="player-self-name" id="playerSelfName"></span>
                <span class="your-turn-badge" id="yourTurnBadge">âš¡ Your Turn</span>
            </div>
            <div class="hand-info-right">
                <button class="btn-sort-toggle" id="btnSortToggle" onclick="toggleSortMode()" title="Toggle sort (Color/Type)">ğŸ¨</button>
                <span class="card-count-label" id="cardCountLabel">0 cards</span>
            </div>
        </div>
        <div class="emoji-bar" id="emojiBar">
            <button onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</button>
            <button onclick="sendEmoji('ğŸ˜¡')">ğŸ˜¡</button>
            <button onclick="sendEmoji('ğŸ‘')">ğŸ‘</button>
            <button onclick="sendEmoji('ğŸ’€')">ğŸ’€</button>
            <button onclick="sendEmoji('ğŸ”¥')">ğŸ”¥</button>
            <button onclick="sendEmoji('ğŸ˜')">ğŸ˜</button>
        </div>
        <div class="quick-phrases" id="quickPhrases">
            <button onclick="sendQuickPhrase('Nice move!')">Nice move!</button>
            <button onclick="sendQuickPhrase('Hurry up!')">Hurry up!</button>
            <button onclick="sendQuickPhrase('No way! ğŸ˜±')">No way!</button>
            <button onclick="sendQuickPhrase('GG ğŸ¤')">GG</button>
            <button onclick="sendQuickPhrase('Oops! ğŸ˜…')">Oops!</button>
        </div>
        <div class="hand-container" id="playerHand"></div>
        <button class="btn-pass" id="btnPass" onclick="handlePass()">Pass Turn</button>
    </div>

    <!-- UNO Button -->
    <div class="uno-btn-container">
        <button class="btn-uno" id="btnUno" onclick="handleUno()">UNO!</button>
    </div>

    <!-- Color Picker -->
    <div class="color-picker-overlay" id="colorPickerOverlay">
        <div class="color-picker">
            <h3>Choose a Color</h3>
            <div class="color-options">
                <div class="color-option opt-red" onclick="handleColorChoice('red')"></div>
                <div class="color-option opt-blue" onclick="handleColorChoice('blue')"></div>
                <div class="color-option opt-green" onclick="handleColorChoice('green')"></div>
                <div class="color-option opt-yellow" onclick="handleColorChoice('yellow')"></div>
            </div>
        </div>
    </div>

    <!-- Rules Button -->
    <button class="btn-rules-toggle" id="btnRulesToggle" onclick="toggleRules()" title="Rules">ğŸ“–</button>

    <!-- Floating Emojis -->
    <div class="floating-emojis" id="floatingEmojis"></div>

    <!-- Action Splash -->
    <div class="action-splash" id="actionSplash"></div>

    <!-- Card Fly Animation Container -->
    <div class="card-fly-container" id="cardFlyContainer"></div>

    <!-- Confetti -->
    <canvas class="confetti-canvas" id="confettiCanvas"></canvas>

    <!-- Rules Modal -->
    <div class="rules-overlay" id="rulesOverlay" onclick="toggleRules()">
        <div class="rules-modal" onclick="event.stopPropagation()">
            <div class="rules-header"><span>ğŸ“– UNO Rules</span><button class="rules-close" onclick="toggleRules()">âœ•</button></div>
            <div class="rules-body">
                <h4>ğŸ¯ Objective</h4>
                <p>Be the first to play all your cards.</p>
                <h4>ğŸƒ Card Types</h4>
                <ul>
                    <li><b>Number (0-9)</b> â€” Match by color or number</li>
                    <li><b>Skip âŠ˜</b> â€” Next player loses their turn</li>
                    <li><b>Reverse âŸ³</b> â€” Reverses play direction</li>
                    <li><b>Draw Two +2</b> â€” Next player draws 2 (stackable!)</li>
                    <li><b>Wild W</b> â€” Play anytime, choose a color</li>
                    <li><b>Wild +4</b> â€” Choose color, next draws 4 (stackable!)</li>
                </ul>
                <h4>ğŸ“‹ How to Play</h4>
                <ul>
                    <li>Match the top discard by <b>color</b>, <b>number</b>, or <b>type</b></li>
                    <li>Can't play? Draw a card from the pile</li>
                    <li>Drew a playable card? You may play it or pass</li>
                    <li>+2 can stack on +2, +4 can stack on +4</li>
                </ul>
                <h4>ğŸ”¥ UNO Call</h4>
                <ul>
                    <li>Press <b>UNO</b> when you have 2 cards (before playing)</li>
                    <li>Forgot? Other players can <b>Catch</b> you â†’ +2 penalty!</li>
                </ul>
                <h4>â±ï¸ Timer</h4>
                <p>30 seconds per turn. Auto-draw & pass if time runs out.</p>
            </div>
        </div>
    </div>

    <!-- Game Over -->
    <div class="game-over-overlay" id="gameOverOverlay">
        <div class="game-over-card">
            <h2>ğŸ† Game Over!</h2>
            <p class="winner-name" id="winnerName">â€”</p>
            <table class="scores-table" id="scoresTable">
                <thead>
                    <tr><th>Player</th><th style="text-align:right">Score</th></tr>
                </thead>
                <tbody id="scoresBody"></tbody>
            </table>
            <button class="btn-play-again" id="btnPlayAgain" onclick="handlePlayAgain()">Play Again</button>
            <button class="btn-back-lobby" onclick="handleBackToLobby()">Back to Home</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- App Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/game-engine.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/sounds.js"></script>
    <script src="js/game.js"></script>

    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {});
            });
        }
    </script>
</body>
</html>
